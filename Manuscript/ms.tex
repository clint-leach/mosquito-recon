% Template for PLoS
% Version 3.4 January 2017
%
% % % % % % % % % % % % % % % % % % % % % %
%
% -- IMPORTANT NOTE
%
% This template contains comments intended 
% to minimize problems and delays during our production 
% process. Please follow the template instructions
% whenever possible.
%
% % % % % % % % % % % % % % % % % % % % % % % 
%
% Once your paper is accepted for publication, 
% PLEASE REMOVE ALL TRACKED CHANGES in this file 
% and leave only the final text of your manuscript. 
% PLOS recommends the use of latexdiff to track changes during review, as this will help to maintain a clean tex file.
% Visit https://www.ctan.org/pkg/latexdiff?lang=en for info or contact us at latex@plos.org.
%
%
% There are no restrictions on package use within the LaTeX files except that 
% no packages listed in the template may be deleted.
%
% Please do not include colors or graphics in the text.
%
% The manuscript LaTeX source should be contained within a single file (do not use \input, \externaldocument, or similar commands).
%
% % % % % % % % % % % % % % % % % % % % % % %
%
% -- FIGURES AND TABLES
%
% Please include tables/figure captions directly after the paragraph where they are first cited in the text.
%
% DO NOT INCLUDE GRAPHICS IN YOUR MANUSCRIPT
% - Figures should be uploaded separately from your manuscript file. 
% - Figures generated using LaTeX should be extracted and removed from the PDF before submission. 
% - Figures containing multiple panels/subfigures must be combined into one image file before submission.
% For figure citations, please use "Fig" instead of "Figure".
% See http://journals.plos.org/plosone/s/figures for PLOS figure guidelines.
%
% Tables should be cell-based and may not contain:
% - spacing/line breaks within cells to alter layout or alignment
% - do not nest tabular environments (no tabular environments within tabular environments)
% - no graphics or colored text (cell background color/shading OK)
% See http://journals.plos.org/plosone/s/tables for table guidelines.
%
% For tables that exceed the width of the text column, use the adjustwidth environment as illustrated in the example table in text below.
%
% % % % % % % % % % % % % % % % % % % % % % % %
%
% -- EQUATIONS, MATH SYMBOLS, SUBSCRIPTS, AND SUPERSCRIPTS
%
% IMPORTANT
% Below are a few tips to help format your equations and other special characters according to our specifications. For more tips to help reduce the possibility of formatting errors during conversion, please see our LaTeX guidelines at http://journals.plos.org/plosone/s/latex
%
% For inline equations, please be sure to include all portions of an equation in the math environment.  For example, x$^2$ is incorrect; this should be formatted as $x^2$ (or $\mathrm{x}^2$ if the romanized font is desired).
%
% Do not include text that is not math in the math environment. For example, CO2 should be written as CO\textsubscript{2} instead of CO$_2$.
%
% Please add line breaks to long display equations when possible in order to fit size of the column. 
%
% For inline equations, please do not include punctuation (commas, etc) within the math environment unless this is part of the equation.
%
% When adding superscript or subscripts outside of brackets/braces, please group using {}.  For example, change "[U(D,E,\gamma)]^2" to "{[U(D,E,\gamma)]}^2". 
%
% Do not use \cal for caligraphic font.  Instead, use \mathcal{}
%
% % % % % % % % % % % % % % % % % % % % % % % % 
%
% Please contact latex@plos.org with any questions.
%
% % % % % % % % % % % % % % % % % % % % % % % %

\documentclass[10pt,letterpaper]{article}
\usepackage[top=0.85in,left=2.75in,footskip=0.75in]{geometry}

% amsmath and amssymb packages, useful for mathematical formulas and symbols
\usepackage{amsmath,amssymb}

% Use adjustwidth environment to exceed column width (see example table in text)
\usepackage{changepage}

% Use Unicode characters when possible
\usepackage[utf8x]{inputenc}

% textcomp package and marvosym package for additional characters
\usepackage{textcomp,marvosym}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

% Use nameref to cite supporting information files (see Supporting Information section for more info)
\usepackage{nameref,hyperref}

% line numbers
\usepackage[right]{lineno}

% ligatures disabled
\usepackage{microtype}
\DisableLigatures[f]{encoding = *, family = * }

% color can be used to apply background shading to table cells only
\usepackage[table]{xcolor}

% array package and thick rules for tables
\usepackage{array}

% create "+" rule type for thick vertical lines
\newcolumntype{+}{!{\vrule width 2pt}}

% create \thickcline for thick horizontal lines of variable length
\newlength\savedwidth
\newcommand\thickcline[1]{%
  \noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
  \cline{#1}%
  \noalign{\vskip\arrayrulewidth}%
  \noalign{\global\arrayrulewidth\savedwidth}%
}

% \thickhline command for thick horizontal lines that span the table
\newcommand\thickhline{\noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
\hline
\noalign{\global\arrayrulewidth\savedwidth}}


% Remove comment for double spacing
%\usepackage{setspace} 
%\doublespacing

% Text layout
\raggedright
\setlength{\parindent}{0.5cm}
\textwidth 5.25in 
\textheight 8.75in

% Bold the 'Figure #' in the caption and separate it from the title/caption with a period
% Captions will be left justified
\usepackage[aboveskip=1pt,labelfont=bf,labelsep=period,justification=raggedright,singlelinecheck=off]{caption}
\renewcommand{\figurename}{Fig}

% Use the PLoS provided BiBTeX style
\bibliographystyle{plos2015}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother

% Leave date blank
\date{}

% Header and Footer with logo
\usepackage{lastpage,fancyhdr,graphicx}
\usepackage{epstopdf}
\pagestyle{myheadings}
\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{27.023pt}
\lhead{\includegraphics[width=2.0in]{PLOS-submission.eps}}
\rfoot{\thepage/\pageref{LastPage}}
\renewcommand{\footrule}{\hrule height 2pt \vspace{2mm}}
\fancyheadoffset[L]{2.25in}
\fancyfootoffset[L]{2.25in}
\lfoot{\sf PLOS}

%% Include all macros below

\newcommand{\lorem}{{\bf LOREM}}
\newcommand{\ipsum}{{\bf IPSUM}}

%% END MACROS SECTION


\begin{document}
\vspace*{0.2in}

% Title must be 250 characters or less.
\begin{flushleft}
{\Large
\textbf\newline{Linking mosquito surveillance to dengue fever through Bayesian mechanistic modeling}
}
\newline
% Insert author names, affiliations and corresponding author email (do not include titles, positions, or degrees).
\\
Clinton Leach\textsuperscript{1,2*},
Jennifer Hoeting\textsuperscript{2}
Kim Pepin\textsuperscript{3},
Alvaro Eiras\textsuperscript{4},
Mevin Hooten\textsuperscript{5,6,2},
Colleen Webb\textsuperscript{1}


\bigskip
\textbf{1} Graduate Degree Program in Ecology, Colorado State University, Fort Collins, CO, USA
\\
\textbf{2} Department of Statistics, Colorado State University, Fort Collins, CO, USA
\\
\textbf{3} National Wildlife Research Center, United States Department of Agriculture, Wildlife Services, Fort Collins, CO, USA
\\
\textbf{4} Departamento de Parasitologia, Universidade Federal de Minas Gerais, Belo Horizonte, MG, Brazil
\\
\textbf{5} U.S. Geological Survey, Colorado Cooperative Fish and Wildlife Research Unit
\\
\textbf{6} Department of Fish, Wildlife, and Conservation Biology, Colorado State University
\bigskip

% Insert additional author notes using the symbols described below. Insert symbol callouts after author names as necessary.
% 
% Remove or comment out the author notes below if they aren't used.


% Use the asterisk to denote corresponding authorship and provide email address in note below.
* clint.leach@colostate.edu

\end{flushleft}
% Please keep the abstract below 300 words
\section*{Abstract}

Our ability to effectively prevent the transmission of the dengue virus through targeted control of its vector, \emph{Aedes aegypti}, depends critically on our understanding of the link between mosquito abundance and human disease risk.
Mosquito and clinical surveillance data are widely collected, but linking them requires a modeling framework that accounts for the complex non-linear mechanisms involved in transmission.
Most critical are the bottleneck in transmission imposed by mosquito lifespan relative to the virus' extrinsic incubation period, and the dynamics of human immunity.
We developed a differential equation model of dengue transmission and embedded it in a Bayesian hierarchical framework that allowed us to estimate latent time series of mosquito demographic rates from mosquito trap counts and dengue case reports from the city of Vitoria, Brazil.
We used the fitted model to explore the effect of adult mosquito control on the disease burden in each year.
We found that mosquito control deployed between 30 and 40 weeks prior to the start of the year was most effective at preventing cases in that year. 
This timing generally coincided with a local minimum in the size of the susceptible pool.
Uncertainty in the effectiveness of control interventions was driven largely by uncertainty in the period of cross-immunity, with longer periods of cross-immunity leading to less effective control.
Understanding the dynamics of temporary human immunity is thus critical for understanding the effect of mosquito control efforts on human disease.

% Please keep the Author Summary between 150 and 200 words
% Use first person. PLOS ONE authors please skip this step. 
% Author Summary not valid for PLOS ONE submissions.   
% \section*{Author summary}

\linenumbers

% Use "Eq" instead of "Equation" for equation citations.

\section*{Introduction}

Dengue fever is a massive global public health burden, with millions of cases per year \cite{Bhatt2013}.  
Because the dengue virus (DENV) is vectored by the mosquito \textit{Aedes aegypti}, dengue fever is prevented primarily through mosquito control programs \cite{Achee2015}.
Though there have been documented successes, there is limited evidence for the long-term sustainability and effectiveness of these control programs \cite{Morrison2008}.
As a result, there is a growing recognition that effective control needs to be guided by high quality vector surveillance, together with quantitative tools that synthesize vector surveillance with clinical surveillance, account for local epidemiology, and facilitate local decision making \cite{Morrison2008, Scott2010b}.
Moreover, mosquito control needs to be guided by an understanding of the link between mosquito abundance and disease risk so that the mosquitoes most responsible for transmission can be targeted \cite{Scott2010a, Scott2010b}.

Many of the attempts to establish this link have found a weak relationship between mosquito abundance indices and incidence of disease in humans \cite{Bowman2014, Pepin2015, Cromwell2017}.
However, these attempts often do not account for the complex, non-linear interactions that mediate the relationship between mosquito abundance and human disease.
In particular, host immunity is a key intrinsic driver of infectious disease dynamics, and conditions favorable for transmission can only lead to an outbreak of disease when there is a sufficiently large population of susceptible hosts \cite{Koelle2004, Koelle2005}.
As such, the ability of mosquitoes to contribute to DENV transmission depends critically on the level of immunity in the human population \cite{Scott2010a}.
Further, the cycle of transmission between humans and mosquitoes is influenced not just by mosquito abundance, but also by mosquito survival relative to the virus' incubation period in mosquitoes \cite{Smith2012}.
In fact, whether or not an exposed mosquito will survive long enough to become infectious represents a critical bottleneck in the transmission process and leads to nonlinear dependence of transmission on mosquito survival \cite{Smith2012}.

The importance of intrinsic nonlinearities, potentially alongside seasonality and stochastic forcing \cite{Ellner1998, Koelle2004, Grenfell2002}, in governing human disease risk highlight the need to integrate mechanistic modeling into the quantitative tools used to understand the effects of control interventions.
Such mechanistic models can often perform better than complex autoregressive statistical models in describing and forecasting population dynamics \cite{Reilly2005}.
Moreover, in the absence of case-control studies, mechanistic models can provide scenario-based tools that can be used to predict the effect of management actions \cite{Buckland2007}.

Differential equation models provide a natural way to encode the relevant biological mechanisms, although it is important to also account for sources of uncertainty in those models \cite{Hotelling1927, Wikle2010}.
In particular, the values of parameters (e.g., the length of time for which a host is infectious) are often uncertain, which can lead to large uncertainty about the effects of management actions \cite{Elderd2006}.
The structure of the processes themselves can be uncertain \cite{Ellner1998}, and need to be informed by available, often noisy, data.
Bayesian hierarchical modeling provides a coherent framework to account for and integrate this uncertainty across the three levels of the model (data, process, and parameters \cite{Berliner1996, Cressie2009}).

In this paper, we aim to integrate these elements -- a detailed mechanistic model of dengue transmission with a full Bayesian accounting of uncertainty --  to better understand the interplay of forces governing dengue dynamics and their interaction with potential vector control interventions.
We apply this framework to clinical and entomological surveillance data from the city of Vitoria, Brazil.
These data allow us to estimate a latent time series of mosquito mortality rates that modulate the transmission process and link mosquito abundance to human disease.  
We then use the fitted model to explore how perturbations to the mosquito population propagate and interact with the complex epidemiology and nonlinearities involved in dengue transmission.

\section*{Methods}

\subsection*{Study system and data}

Vitoria is a coastal city and the capital of the state of Espirito Santo, Brazil, with a population of 327,801 as of 2010 \cite{vitpop}.
Since 2008, the company Ecovec has monitored mosquito abundance for the city using approximately 1327 sticky traps (MosquiTRAP, \cite{Eiras2009}) arranged in a grid across the city.
Each trap is checked weekly and the mosquitoes inside counted and identified, with the results sent to a central database that city managers then use to map mosquito infestations and target control.
These data comprise 243 weeks (week 1 of 2008 through week 34 of 2012) of total city-wide counts of trapped gravid female \emph{Aedes aegypti}.
It is important to note that this time series reflects both natural fluctuations in mosquito density and fluctuations driven by the city's existing mosquito control program.
In addition, dengue fever is a mandatory notifiable disease, and thus the city's Ministry of Health Secretary maintains a database of weekly notified probable dengue cases (i.e., medical care sought for dengue-like symptoms) for the same time period.

\subsection*{Process Model}

Dengue epidemiology is complicated considerably by the presence of four simultaneously circulating serotypes.
Infection with one serotype confers life-long immunity to that serotype, along with temporary immunity to other serotypes \cite{Wearing2006}.  
As this cross-immunity wanes, antibodies from the previous infection can result in antibody-dependent enhancement (ADE), wherein human hosts are more susceptible to infection with the other serotypes and more likely to develop severe symptoms (i.e., dengue haemorrhagic fever or dengue shock syndrome)\cite{Wearing2006}.
The strength and duration of these different inter-serotype interactions are not well understood, although different models suggest that temporary cross-immunity alone (without ADE) is sufficient to reproduce observed multi-annual dynamics in Thailand \cite{Wearing2006,Reich2013}.
Similarly, Aguiar \emph{et al.} \cite{Aguiar2013} found that capturing primary and secondary infections and the period of cross-immunity is critical, but that explicitly including all four serotypes (at great cost to model complexity) does not perform better than a two serotype model.

Explicitly accounting for interactions between serotypes, even only two of the four, leads to a large and complex mechanistic model.
Moreover, because dengue case reports do not include information on serotype, we do not have enough information to inform the dynamics of individual serotypes.
As such, we develop an SEIRS compartment model, similar to \cite{Newton1992, Burattini2008, Pinho2010} which drops serotype-specific dynamics but preserves the period of cross-immunity and the possibility of reinfection.
In this framework, susceptible humans ($S$) become exposed ($E$) through contact with infectious mosquitoes ($V_I$).
Following a latent period ($\frac{1}{\rho}$), exposed humans become infectious ($I$) at which point they can infect susceptible mosquitoes ($V_S$).
Infectious humans recover at rate $\gamma$ and subsequently remain immune ($R$) for a period ($\frac{1}{\delta}$) after which they re-enter the susceptible class.

Similarly, susceptible mosquitoes ($V_S$) become exposed ($V_E$) by biting infectious humans and pass through a temperature-dependent incubation period ($\frac{1}{\rho_{vt}}$) before becoming infectious ($V_I$).
Because the assumption of an exponentially distributed incubation period (implicit in the specification of a differential equation model) is a poor fit to laboratory observations \cite{Chan2012}, we instead implement a gamma-distributed incubation period by chaining multiple exposed classes together (taking advantage of the fact that a gamma-distributed random variable can be generated through the sum of a collection of exponential random variables with the same rate parameter) \cite{Lloyd2001}.
Total mosquito population size ($V_N$) is controlled by a forced, seasonally varying growth rate ($r(t)$), while the transmission bottleneck is captured with a forced, seasonally varying mortality rate ($d(t)$).
Captured mosquitoes ($V_C$) accumulate at rate $\phi_q \tau_t$, where $\phi_q$ is the per-trap capture rate, and $\tau_t$ is the number of traps deployed in week $t$.

We specified the differential equations governing the human population as:
\begin{align} 
\frac{dS}{dt} &= bN - bS - \lambda \frac{V_{I}}{N} S + \delta R\\
\frac{dE}{dt} &= \lambda \frac{V_{I}}{N} S - (\rho + b)E\\
\frac{dI}{dt} &= \rho E - (\gamma + b)I\\
\frac{dR}{dt} &= \gamma I - (\delta + b)R
\end{align}
while the equations governing the mosquito (vector) population are:
\begin{align}
\frac{dV_N}{dt} & = r(t) V_N - \phi_q \tau(t) V_N \\
\frac{dV_{E1}}{dt} &= \lambda \frac{I}{N} V_S - (\rho_{v}(t) + d(t) + \phi_q \tau(t))V_{E1}\\
\frac{dV_{E2}}{dt} &= \rho_{v}(t) V_{E1} - (\rho_{v}(t) + d(t) + \phi_q \tau(t))V_{E2}\\
\frac{dV_{E3}}{dt} &= \rho_{v}(t) V_{E2}  - (\rho_{v}(t) + d(t) + \phi_q \tau(t))V_{E3}\\
\frac{dV_{E4}}{dt} &= \rho_{v}(t) V_{E3}  - (\rho_{v}(t) + d(t) + \phi_q \tau(t))V_{E4}\\
\frac{dV_I}{dt} &= \rho_{v}(t) V_{E4} - (d(t) + \phi_q \tau(t)) V_I\\
\frac{dV_C}{dt} & = \phi_q \tau(t) V_N\\
V_S &= V_N - V_E - V_I.
\end{align}

We model the centered and log-transformed mosquito mortality rate ($\nu$) and the per-capita mosquito growth rate ($r$) as forced harmonic oscillators with natural periods of one year:
\begin{align}
\frac{d^2\nu}{dt^2} &= -\omega^2 \nu + \epsilon_{\nu t}\\
\frac{d^2 r}{dt^2} &= -\omega^2 r + \epsilon_{rt},
\end{align}
where the angular frequency of the oscillator, $\omega = 2\pi / 52$, the mosquito death rate $d(t) = d_0 \exp(\nu(t))$, and
\begin{align}
\epsilon_{\nu t} & \sim \text{Normal}(0, \sigma^2_{\nu})\\
\epsilon_{rt} & \sim \text{Normal}(0, \sigma^2_r),
\end{align}
for $t = 1 \dots 243$.
These stochastically-forced harmonic oscillators provide a flexible framework for generating smooth seasonal oscillations in the latent mosquito processes \cite{Ramsay2017}.

\subsection*{Data model}

To connect the differential equation model to the observed case reports, we add an extra state, $C$, that collects the cumulative number of transitions from the exposed to infectious class (assuming that case reporting coincides with the onset of symptoms).
We then model the number of new cases reported in week $t$ ($y_t$) as:
\begin{equation}
y_t  \sim \text{NegBin}(\phi_y (C(t) - C(t-1)), \eta_y),
\end{equation}
where $\phi_y$ is the reporting probability, $C(t) - C(t-1)$ is the number of new infectious humans in week $t$, and $\eta_y$ controls the overdispersion relative to the Poisson distribution.

We similarly model the number of mosquitoes trapped in week $t$ ($q_t$) as:
\begin{equation}
q_t \sim \text{NegBin}(V_{C}(t) - V_{C}(t-1), \eta_q),
\end{equation}
where $V_{C}(t) - V_{C}(t-1)$ is the number of new mosquitoes captured in week $t$, and $\eta_q$ controls overdispersion relative to the Poisson distribution.

\subsection*{Parameterization and priors}

Several of the parameters in this model are assumed to be fixed and known (Table 1).
The human population size and average life span (which we use to parameterize the birth/death rate) for Vitoria are taken from the 2010 census.
To maintain identifiability, the transmission rate ($\lambda$) and case reporting probability ($\phi_y$) are also fixed at literature values.
Lastly, the extrinsic incubation period in mosquitoes is modeled as a function of weekly mean temperature and forced with weather station data obtained from WeatherUnderground.

The remaining parameters include the epidemiological parameters ($\rho$, $\gamma$, $\delta$, $d_0$), the initial conditions of the model ($S_0$, $E_0$, $I_0$, $R_0$, $V_{N0}, \nu_0, r_0$), the variances of the latent mosquito processes ($\sigma^2_r$, $\sigma^2_{\nu}$), and the remaining measurement parameters ($\phi_q$, $\eta_y$, $\eta_q$).  
Where possible, we specified informative priors on these parameters based on existing laboratory and field studies (see Table 1 for means and Supplemental Material for detailed explanations).

\begin{table}[!ht]
\label{parameters}
\begin{adjustwidth}{-2.25in}{0in} 
\begin{center}
\caption{Model parameters and their values.  Parameters above the rule are fixed, while parameters below the rule are random, with the value giving the prior mean.}
\begin{tabular}{llll}
Parameter & Description & Value & Citation\\
\hline
$N$ & Human population size & 327801 & \cite{vitpop} \\
$1/d$ & Human life-span & 76 years & \cite{vitlong} \\
$\lambda$ & Transmission rate & 4.87 week$^{-1}$ & \cite{Scott2000}\\
$\phi_y$ & Reporting probability & 0.083 & \cite{Silva2016}\\
$1/\rho_{vt}$ & Extrinsic incubation period & $28\exp \left( 0.2 T_t - 8 \right)$ & \cite{Chan2012}\\
$V_{E0}$ & Initial exposed mosquitoes &  0 & \\
$V_{I0}$ & Initial infectious mosquitoes & 0 & \\
\hline
$d_0$ & Baseline mosquito mortality rate & 1.47 week$^{-1}$ & \cite{Brady2013} \\
$1/\rho$ & Latent period in host & 0.87 weeks  & \cite{Chan2012}\\
$\gamma$ & Rate of loss of infectiousness & 3.5 week$^{-1}$ & \cite{Nguyet2013}\\
$1/\delta$ & Period of cross-immunity & 97 weeks &  \cite{Reich2013}\\
$\sigma_r$ & Standard deviation of mosquito growth rate forcing & $0^*$ & \\
$\sigma_{\nu}$ & Standard deviation of mosquito mortality rate forcing & $0^*$ & \\
$S_0$ & Proportion initially susceptible & 0.4 & \cite{Cardoso2011a} \\
$E_0$ & Number initially exposed & $100$ & \\
$I_0$ & Number initially infectious & $60$ & \\
$r_0$ & Initial mosquito population growth rate & 0 & \\
$\nu_0$ & Initial unconstrained mosquito mortality rate & 0 & \\
$V_{N0}$ & Initial mosquito population size & $2N$ & \\
$\phi_q$ & Per-trap mosquito capture rate & $2 \times 10^{-6}$ week$^{-1}$ & \\
$\eta_y$ & Overdispersion of case reports & $0^*$ & \\
$\eta_q$ & Overdispersion of mosquito trap counts & $0^*$ & \\
\end{tabular}
\end{center}
\end{adjustwidth}
$^*$ indicates prior mode, rather than mean.
\end{table}

\subsection*{Implementation}

Combining the data, process, and parameter models \cite{Berliner1996}, we can summarize the full hierarchical model as:
\begin{align}
y_t | \cdot & \sim \text{NegBin}(\phi_y (C(t) - C(t-1)), \eta_y),
\\
q_t | \cdot &\sim \text{NegBin}(V_{C}(t) - V_{C}(t-1), \eta_q)\\
(\mathbf{C}, \mathbf{V_C}) & = \mathcal{M}(\boldsymbol{\epsilon_r}, \boldsymbol{\epsilon_{\nu}},\boldsymbol{\theta})\\
\epsilon_{rt} & \sim \text{Normal}(0, \sigma^2_r)\\
\epsilon_{\nu t} & \sim \text{Normal}(0, \sigma^2_{\nu})\\
\boldsymbol{\theta} & \sim [\boldsymbol{\theta}]
\end{align}
where $\boldsymbol{\theta}$ is a vector of all the model parameters and initial conditions, and $\mathcal{M}(\boldsymbol{\epsilon_r}, \boldsymbol{\epsilon_{\nu}},\boldsymbol{\theta})$ represents the (numeric) solution to the differential equation as a function of $\boldsymbol{\theta}$ and the weekly stochastic forcing terms ($\boldsymbol{\epsilon_{r}}, \boldsymbol{\epsilon_{\nu}}$).
Sampling from the posterior distribution of the parameters and forcing terms in this model is difficult due to multimodality, variable parameter sensitivities (e.g., small changes in one parameter may lead to large changes in output, while similar changes in another parameter may have little effect), and potentially strong posterior correlations induced by the nonlinearity of the differential equation model \cite{Reilly2005, Girolami2008, Calderhead2011}.
In addition, the computational burden of numerically solving the differential equation model at each iteration means that sampling efficiency is crucial.
These problems can be mitigated somewhat by introducing stochasticity through the $\epsilon_t$ in the mosquito demographic processes.
This allows the data to pull the latent states closer even when the parameters are far from optimal values \cite{Leander2014}.
This reduces multimodality and allows gradient-based methods like Hamiltonain Monte Carlo (HMC) to more easily and efficiently traverse the posterior.
Samples from the posterior distribution were thus generated using HMC implemented in the rstan package \cite{Carpenter2016, Rstan2017} for R \cite{R2016}. 
We ran 3 chains with different starting values for 10,000 iterations each, discarding the first 5,000 as burn-in.
Convergence diagnostics and mixing were evaluated using the shinystan package \cite{shinystan}.
Within stan, the solution to the differential equation model was approximated with an Euler scheme with a time step of 1 day.  
Timesteps as small as $1/8$ of a day were explored and did not qualitatively change our results.

\subsection*{Mosquito control simulations}

Given samples from the posterior distribution as obtained above, we simulated the effects of a single pulse of control applied in each week of the first four years of the time series.
Because the city already implements responsive, targeted control with the aim of reducing local mosquito density during an existing outbreak, we focused our simulations on exploring the longer-term feedbacks induced by mosquito control and the ability of an intervention to reduce the disease burden in future years.
To obtain the posterior distribution of the proportion of cases prevented in calendar year $j$ by implementing control in week $i$, for each posterior sample $k$, we simulated the dynamics resulting from reducing the mosquito population by $5\%$ at the beginning of week $i$ (affecting susceptible, exposed, and infectious mosquitoes equally, and leaving the estimated mosquito birth and mortality rates unchanged) .
We then compared the number of cases produced during year $j$ in the control scenario to the same number in the uncontrolled scenario.
A $5\%$ reduction in mosquito abundance was chosen to keep our simulations conservative relative to field estimates of the mortality induced by spraying \cite{Esu2010}, and to avoid pushing the model into the unrealistic range of dengue eradication.

\section*{Results}

The model captured the observed dynamics of both case reports and mosquito trap counts (Figure \ref{timeseries}).
The estimated posterior median case reports explained 90\% of the variation in the observed time series, while the posterior median mosquito trap counts explained 46\% of the variation in the observed time series. 
In addition, posterior predictive checks showed that the model reproduced the total number of cases reported and mosquitoes captured as well as the autocorrelation structure of both time series (with the exception of slightly underestimating the autocorrelation for short lags, Supplemental Figures 6 - 8).
The posterior distributions of the rate of infectious decay ($\gamma$) and the period of cross-immunity ($1/\delta$) did not differ substantially from their priors, suggesting that the Vitoria data contained little additional information about these parameters (Supplemental Figure 3).
The estimated latent period in a human host ($1/\rho$, the expected time it takes for an exposed human to become infectious to biting mosquitoes) is influenced more strongly by the data, with a posterior mean of 1.53 weeks compared to a prior mean of 0.87 weeks.

The estimated weekly mosquito mortality rate varied seasonally, and was positively correlated with temperature (Figure \ref{mortality}).
The oscillations in estimated mosquito mortality were more complex than purely sinusoidal, with variations in shape from year to year.
The posterior mean of the baseline mortality rate, around which the time series oscillated, was 0.7/week, roughly half the prior mean of 1.47/week.
The marginal posterior means of the $\epsilon_{\nu t}$ forcing the mosquito mortality process exhibited a higher-frequency periodic oscillation (Supplementary Figure 1), although the marginal posterior distribution of each $\epsilon_{\nu t}$ overlapped zero.
In addition, the standard deviation of the mortality forcing terms was small relative to the weak prior ($E(\sigma_{\nu}|\mathbf{y}) = 0.01$, Supplemental Figure 2).

Mosquito control (i.e. the removal of $5\%$ of the adult population in a given week), had the largest effect on the number of dengue cases in a given year when implemented between 30 and 40 weeks prior to the start of that year (Figure \ref{control}).
Our simulations predicted that control implemented during this time could prevent between $20$ and $30\%$ of the dengue cases in the following year, while control implemented during the target outbreak was much less effective.

The effect of a given control intervention seemed to be driven largely by its interaction with, and timing relative to, fluctuations in human immunity.
In particular, mosquito control seemed to be most effective when applied at or near a local minimum in the number of suceptible humans (Figure \ref{timing}).
In addition, human immunity, as controlled by the period of cross-immunity ($1/\delta$), was a major driver of uncertainty in the effect of a given control intervention.
Specifically, we observed a strong negative posterior correlation between the maximum proportion of cases that could be prevented in a given year (i.e., the number of cases prevented by control implemented in the optimal week) and the period of cross-immunity (Figure \ref{immunity}). 
In simulations with a short period of cross-immunity, the susceptible pool replenished quickly, leading to a relatively large pool of susceptibles at any time.
In simulations with a long period of cross-immunity, the susceptible pool replenished more slowly, leaving the population with relatively few susceptibles.
The negative correlation between the effectiveness of control and the period of cross-immunity thus suggests that mosquito control becomes less effective as the overall availability of susceptibles  becomes more limiting.

\begin{figure}[!h]
\includegraphics[angle = 270, scale = 1]{figures/fig1.eps}
\caption{{\bf Vitoria data and model fits.}
Weekly observations from 2008 to week 34 of 2012 (points), with corresponding median posterior prediction (line) and 80\% credible interval (gray band). A: reported dengue cases. B: total number of trapped mosquitoes.
}
\label{timeseries}
\end{figure}

\begin{figure}[!h]
\includegraphics[angle = 270, scale = 1]{figures/fig2.eps}
\caption{{\bf Estimated latent mosquito mortality rate.}
A: Time series of mortality rate, showing median posterior estimate (line) and 80\% credible interval (gray band). B: estimated weekly mosquito mortality rate as a function of weekly mean temperature.
}
\label{mortality}
\end{figure}

\begin{figure}[!h]
\includegraphics[angle = 270, scale = 1]{figures/fig3.eps}
\caption{{\bf The effect of mosquito control as a function of the week in which it was applied.}
Summary of posterior predicted distribution of the proportion of cases that would be prevented in each year (top to bottom, 2009 to 2012) by control enacted in a given week relative to the start of that year. Black lines indicate the posterior median, while gray ribbons indicate the $80\%$ credible interval.
}
\label{control}
\end{figure}

\begin{figure}[!h]
\includegraphics[angle = 270, scale = 1]{figures/fig4.eps}
\caption{{\bf Timing of optimal control relative to disease and mosquito dynamics.}
The vertical gray lines indicate the median week at which control was most effective in preventing cases in the following calendar year. A: posterior median estimate of new dengue cases per week. B: posterior median estimate of the proportion of susceptible individuals. C: posterior median estimate of number of mosquitoes per person each week.
}
\label{timing}
\end{figure}

\begin{figure}[!h]
\includegraphics[angle = 270, scale = 0.8]{figures/fig5.eps}
\caption{{\bf The effect of cross-immunity on effect of control.}
The posterior distribution of the maximum proportion of cases prevented by control in each year (left to right, 2009 to 2012), as a function of the period of cross-immunity ($1/\delta$). The shading indicates posterior density, with darker shading indicating a larger density of posterior samples in that bin.
}
\label{immunity}
\end{figure}

\section*{Discussion}

\subsection*{Processes driving effect of mosquito control}

Infectious diseases \cite{Ellner1998,Koelle2004} and ecological systems \cite{Bjornstad2001}, are often driven by the combined efforts of intrinsic non-linearities, seasonality, and stochasticity.
In the case of dengue fever, these processes can obscure the relationship between mosquito abundance and human disease.
We found that a mechanistic model with temporary human immunity and seasonal variation in the mosquito mortality rate was able to effectively fit case reports and mosquito surveillance data from Vitoria, Brazil.

The importance of mosquito longevity in driving disease dynamics highlights the potential effectiveness of control efforts that target adult mosquitoes and disrupt transmission by preventing mosquitoes from living long enough to progress through the extrinsic incubation period to the infectious state.
In fact, this forms the basis for much of the theory of adult mosquito control \cite{Burattini2008, Morrison2008, Smith2012}.
Despite this, our simulations suggested that control was likely to be relatively less effective when implemented during an outbreak, due to the large number of infectious human hosts available to transmit to the remaining (and rapidly rebounding) mosquito population \cite{Newton1992, Burattini2008}.
Instead, our results suggest that adult mosquito control efforts are most effective at reducing the disease burden within a given year when applied roughly 30 weeks prior to the start of that year, on the downswing of the previous year's epidemic and seasonal mosquito dynamics.
While the immediate effects of mosquito control implemented during the decline phase of an outbreak may be masked by the natually fading transmission intensity \cite{Stoddard2014}, our results nonetheless indicate long-term benefits that become apparent in the following outbreak.

The mismatch between the timing of the most effective control and the peak in mosquito abundance suggets that mosquito abundance alone was an insufficient predictor of the effect of mosquito control, at least at the city-scale.
Instead, the effectiveness of mosquito control depended, in large part, on the intrinsic long-term feedbacks and lags driven by the dynamics of temporary human immunity.
In fact, control implemented at a 30 week lag was effective largely due to the way it interacted with the dynamics of the susceptible pool. 
Waiting to implement control until the human susceptible population begins to grow (when the influx of individuals whose previous immunity has waned just outpaces the loss of individuals due to infection) allows for additional immunizing infections to build up as the current outbreak subsides, while also disrupting transmission before the susceptibles that will fuel the next outbreak begin to accumulate.
The fact that effect of mosquito control was mediated by the dynamics of human immunity highlights that dengue, like many other diseases (e.g., cholera \cite{Koelle2004, Koelle2005}), is driven by a complex interplay between seasonal forcing and intrinsic non-linearities.

The Bayesian framework allows for a full accounting of uncertainty across the data, process, and parameter levels of our model \cite{Berliner1996}.
We then carry this uncertainty through to our simulations of control interventions \cite{Elderd2006}.
We found that there can be substantial uncertainty in the proportion of cases prevented by a control intervention (i.e., the width of the ribbons in Figure \ref{control}).
Much of this uncertainty could be attributed to uncertainty in the period of cross-immunity (Figure \ref{immunity}), the posterior distribution of which differed little from our prior based on the estimate of Reich \emph{et al.} \cite{Reich2013}.
Specifically, we found that increasing the period of cross-immunity decreased the proportion of cases prevented by mosquito control.
When the period of cross-immmunity was long (e.g., 200 weeks), the susceptible pool replenished slowly and transmission became limited by the availability of susceptible hosts.
In the face of this limitation, manipulating mosquito abundance had a relatively small effect.
Conversely, when the period of cross-immunity was short (e.g., 50 weeks), susceptibles were abundant and mosquito abundance was instead limiting, in which case reducing mosquito abundance further had a larger effect on transmission.
This interaction between the efficacy of control and human immunity was also demonstrated by ten Bosch \emph{et al.} \cite{TenBosch2016} in their investigation of serotype interactions.
Specifically, they found that adding cross-immunity to models with antibody-dependent enhancement increased the resistance to control (as implemented by reducing the transmission rate).

This notion that mosquito control becomes less effective as the susceptible pool becomes more limiting has potential long-term consequences for the management of dengue fever.
As immunity becomes widespread, either due to continued transmission or eventually vaccination, mosquito abundance will no longer be limiting, and broad-scale mosquito control may become less effective.
At the same time, the replenishment of susceptibles, from both births and waning immunity, means that sustaining effective control over the long-term is likely to be difficult \cite{Scott2010b} and will thus require continued monitoring and management.
As such, existing mosquito monitoring efforts need to be paired with more detailed clinical surveillance to monitor and estimate immunity \cite{Morrison2008}.
In the absence of, or as a supplement to, such data, mechanistic models like the one developed here, or so-called TSIR frameworks that reconstruct the dynamics of the susceptible class \cite{Finkenstadt2000, Reich2013}, need to be further developed to better inform mosquito control efforts.

\subsection*{Model validation and interpretation of $d_v$}

Given the central role that mosquito lifespan plays in driving dengue dynamics, we modeled fluctuations in the mosquito mortality rate using a flexible, forced harmonic oscillator.
This encodes our prior expectation that the mosquito mortality rate should be driven by seasonal environmental forcing (i.e., it should oscillate with a period of one year), while allowing the flexibility to diverge from the simple oscillator and learn from the case reports data.
The fact that the $\epsilon_{\nu}$ forcing terms are the only source of variability in the transmission process, however, means that the estimated mosquito mortality time series could be soaking up other sources of stochasticity or model misspecification.
Hooker and Ellner \cite{Hooker2015} provide a framework for diagnosing such model misspecification in differential equation models using forcing functions similar to our implementation of the $\epsilon_{\nu}$.
In that framework, Hooker and Ellner \cite{Hooker2015} estimate nonparametric forcing functions that modify a fitted differential equation model to provide a good fit to the data.
These forcing functions serve as residuals on the time derivatives, and can be more readily interpreted as indicators of lack-of-fit than residuals on the state variables \cite{Hotelling1927, Hooker2015}.
We do not employ the same explicit goodness-of-fit testing framework as \cite{Hooker2015}, but we can inspect our estimated $\epsilon_{\nu}$ forcing terms in the same spirit.

The periodic structure in the posterior means of the $\epsilon_{\nu t}$ suggests that these terms are accounting for more than just noise, and there may be some unmodeled process influencing fluctuations in mosquito mortality and/or transmission.
Following Hooker and Ellner, we can explore whether this process is likely to result from misspecification of the rates of change of the existing state variables (indicated by a dependence of $\epsilon_{\nu t}$ on other state variables), or from missing state variables altogether (indicated by an additional dependence of $\epsilon_{\nu t}$ on its own lagged values). 
The lack of any apparent relationship between the forcing terms and any of the estimated state variables, combined with the dependence of $\epsilon_{\nu t}$ on previous values (as apparent through the periodic structure), suggest that unmodeled state variables may be the more likely driver of model misspecification.
These unmodeled components could include additional mosquito population dynamic processes (e.g., aquatic stage dynamics, environmental drivers, or control interventions), or epidiemiological processes (e.g., multiple circulating serotypes of the dengue virus).

Despite this suggestion of potential model misspecification, our estimated mosquito mortalities nonetheless fell within the reasonable range from the literature \cite{Maciel-de-Freitas2008, Brady2013}.
Moreover, the fact that our estimated mortality rate increased with temperature also broadly agrees with the empirical literature on mosquito survival \cite{Yang2009, Brady2013}.
This suggests that regardless of unexplained structure in the forcing terms, the pattern of case reports is still very well described by realistic fluctuations in the mosquito mortality rate.

\subsection*{Caveats and extensions}

The case data to which we fit the model represent reports of ``dengue-like illness,'' without laboratory confirmation, and as such could include cases of other diseases with similar symptoms (e.g., chikungunya or Zika).
However, neither chikungunya nor Zika had emerged as substantial public health threats in Brazil by the end of our time series in late 2012 \cite{PAHO2014, PAHO2015}.
In addition, given the high underreporting rate expected for dengue fever \cite{Silva2016}, and the uncertainty incorporated into the measurement model, we expect misreported cases to have a small effect on our analyses.

In addition, it is important to note that the data to which we fit our model implicitly reflect the control efforts already enacted by the city.
These control efforts are guided by the MI-Dengue system, which uses the trap-level mosquito surveillance data to target areas of high mosquito infestation for control (including source reduction, larvacide, and adulticide)\cite{Eiras2009}.
These control efforts may affect our estimates of the mosquito demographic rates, but should not influence our understanding of dengue dynamics.
We are focused not on the factors driving mosquito dynamics, but rather on how the realized mosquito dynamics (whether forced by human intervention or environmental factors) fit into the broader epidemiological picture.
However, our mosquito control simulations should be interepreted as exploring the effect of an additional pulse of city-wide control in addition to the existing control activities.

We view our simulations of this additional pulse of control primarily as a tool to explore and exploit the long-term feedbacks in the city's epidemiological system, whereas existing control is deployed largely to reduce local (in space and time) disease risk.
The frequent use of spatially-targeted mosquito control highlights the potential for spatial heterogeneities in disease risk within a city.
In particular, structured human movement within the city is likely to induce heterogeneous human-mosquito mixing \cite{Adams2009, Cosner2009a, Stoddard2009}.
In addition, spatial variability in socioeconomic factors within the city may also modulate the extent to which mosquitoes in different parts of the city contribute to disease spread \cite{Mondini2008, Honorio2009, Hu2012, DeMattosAlmeida2007}.
Although our model does not account for these heterogeneities, it is nontheless able to capture the city-wide dynamics reasonably well, suggesting that there may be sufficient mixing to appear homogeneous at the city scale.
Further, although our mechanistic model may be able to suggest when a city-wide intervention is likely to be effective, to make the best use of limited resources, spatial prioritization may still be necessary.
Our results emphasize that work to develop the tools necessary for this prioritization should focus not just on prioritization based on the distribution of mosquito abundance, but also on the distribution of human immunity.

\subsection*{Conclusions}

Efforts to connect mosquito abundance to human disease are often hampered by the confounding influences of human immunity and mosquito survival.
The challenges presented by these confounding factors highlight the value of mechanistic information in studying the effect of mosquito control on disease spread.
In the Bayesian context we have deployed here, this mechanistic knowledge, as formalized in the specification of a differential equation model, can be viewed as part of the prior on the relationship between mosquito abundance and human disease \cite{Ellner1998, Wikle2010}.
As such, we should neither ignore it, nor encode it so rigidly that it swamps the signal in our data.

We have developed a simple yet realistic mechanistic model of dengue fever spread that represents the fundamental elements of our prior understanding of dengue epidemiology, while also allowing for uncertainty and flexibility in the fluctuations of mosquito demographic rates.
This mechanistic framework allowed us to capture the critical role of human immunity in mediating the transmission process and to identify critical intervention points that would not be apparent otherwise.
The fully hierarchical Bayesian framework in which we embedded the mechanistic model allowed for a thorough accounting of uncertainty that was carried through to the evaluation of different control strategies.
This combination of model features helps to meet the need for more effective, biologically grounded, and data-driven dengue control policies and offers a building block on which these tools can be further developed in the future.

\section*{Supporting information}

% Include only the SI item label in the paragraph heading. Use the \nameref{label} command to cite SI items in the text.
\paragraph*{S1 Text.}
\label{S1}
{Full description of model and priors, along with all supplemental plots.}

\section*{Acknowledgements}

CBL was supported by the NSF Graduate Research Fellowship Program under grant DGE-1321845.
Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.

\nolinenumbers

% Either type in your references using
% \begin{thebibliography}{}
% \bibitem{}
% Text
% \end{thebibliography}
%
% or
%
% Compile your BiBTeX database using our plos2015.bst
% style file and paste the contents of your .bbl file
% here. See http://journals.plos.org/plosone/s/latex for 
% step-by-step instructions.
% 

\bibliographystyle{plos2015}
\bibliography{dengue}


\end{document}

